import streamlit as st
from google import genai

# App Streamlit para gerar roteiros de v√≠deos no YouTube baseado em tema e tamanho desejado

def main():
    # Configura√ß√£o da p√°gina com √≠cone
    st.set_page_config(page_title="Roteiro YouTube AI", page_icon="üìú", layout="wide")

    st.title("Gerador de Roteiro para V√≠deos")
    st.markdown("Escolha o tema b√≠blico e o tamanho do roteiro em palavras para criar conte√∫do focado no p√∫blico crist√£o.")

    # Configura√ß√£o da API key (n√£o exposta)
    api_key = st.secrets.get("google_api_key", "")
    client = genai.Client(api_key=api_key)

    # Sidebar para escolha de modelo
    st.sidebar.header("Configura√ß√µes do Modelo")
    default_model = st.secrets.get("default_model", "gemini-2.5-pro-exp-03-25")
    model_name = st.sidebar.text_input("Modelo GenAI", value=default_model)

    # Inputs principais
    tema = st.text_input("Tema B√≠blico Espec√≠fico:", "")
    num_palavras = st.number_input("N√∫mero aproximado de palavras:", min_value=100, max_value=10000, value=1000, step=50)

    # Gera√ß√£o do roteiro
    if st.button("Gerar Roteiro", key="btn_gen_script"):
        if not tema.strip():
            st.error("Por favor, preencha o tema b√≠blico.")
        else:
            with st.spinner("Gerando roteiro..."):
                prompt_script = f"Crie um roteiro pronto para narra√ß√£o TTS (semmarca√ß√µes) para um v√≠deo do YouTube com aproximadamente {num_palavras} palavras, focado no p√∫blico crist√£o, sobre o tema b√≠blico: \"{tema}\".\n\n" + \
                "**I. INTRODU√á√ÉO E GANCHO (Aproximadamente 10-15% do roteiro):**\n\n" + \
                "1.  **Gancho Forte e Variado:**\n" + \
                "    *   Comece com uma pergunta ret√≥rica impactante, uma breve e v√≠vida vinheta/hist√≥ria hipot√©tica que o espectador possa se identificar, uma cita√ß√£o b√≠blica poderosa e menos conhecida, ou uma estat√≠stica surpreendente (se aplic√°vel e verdadeira) relacionada ao tema.\n" + \
                "    *   **Exemplo de Varia√ß√£o:** \"[Comece com uma imagem mental forte: 'Imagine [personagem b√≠blico/situa√ß√£o] enfrentando [desafio relacionado ao tema]... Essa luta antiga ecoa em nossos cora√ß√µes hoje quando lidamos com [aspecto moderno do tema]...']\"\n\n" + \
                "2.  **Conex√£o Imediata:** Relacione o gancho diretamente √†s dores, d√∫vidas, anseios ou curiosidades do p√∫blico sobre o [TEMA B√çBLICO ESPEC√çFICO].\n\n" + \
                "3.  **Promessa de Valor Clara:**\n" + \
                "    *   Declare explicitamente o que o espectador vai aprender ou descobrir (ex: \"Nos pr√≥ximos minutos, voc√™ vai descobrir [N√öMERO] chaves/sinais/princ√≠pios sobre [TEMA B√çBLICO ESPEC√çFICO]\", \"Vamos desvendar juntos como [aspecto do tema] pode transformar sua vida espiritual.\").\n" + \
                "    *   Mencione que o conte√∫do √© baseado em ensinamentos b√≠blicos profundos.\n\n" + \
                "4.  **Chamada para Engajamento Inicial (Opcional, mas recomendado):**\n" + \
                "    *   Convide a comentar uma frase espec√≠fica de f√©/c√≥digo espiritual (ex: \"Paz em Cristo\", \"F√© na Palavra\") para criar senso de comunidade.\n" + \
                "    *   Pe√ßa para curtir e se inscrever, explicando brevemente o impacto disso para o minist√©rio/canal e para alcan√ßar outras pessoas.\n" + \
                "    *   **Nota de Melhoria:** \"[Seja breve e direto nesta chamada inicial para n√£o perder reten√ß√£o logo no come√ßo. Pode ser melhor posicionar uma chamada mais elaborada para inscri√ß√£o um pouco mais adiante ou no final.]\"\n\n" + \
                "**II. DESENVOLVIMENTO DO CONTE√öDO (Aproximadamente 60-70% do roteiro):**\n\n" + \
                "1.  **Estrutura de Lista Clara:**\n" + \
                "    *   Divida o conte√∫do principal em [N√öMERO ESPEC√çFICO, ex: 5-8] pontos, sinais, princ√≠pios, ou passos claramente definidos. Use frases de transi√ß√£o curtas e diretas entre eles. Abra loops entre as partes.\n\n" + \
                "2.  **Para cada Ponto/Sinal/Princ√≠pio:**\n" + \
                "    *   **Apresenta√ß√£o:** Introduza o ponto de forma concisa.\n" + \
                "    *   **Exemplo B√≠blico Central:** Utilize uma hist√≥ria, personagem ou passagem b√≠blica relevante para ilustrar e fundamentar o ponto. Narre de forma envolvente, destacando os aspectos cruciais.\n" + \
                "    *   **Aplica√ß√£o Contempor√¢nea:** Conecte o ensinamento b√≠blico √†s experi√™ncias, emo√ß√µes e desafios atuais do espectador. Use linguagem que gere identifica√ß√£o.\n" + \
                "    *   **Aprofundamento e Insight:** Ofere√ßa uma perspectiva espiritual, um \"segredo\" ou uma interpreta√ß√£o menos √≥bvia sobre o ponto, mostrando o \"porqu√™\" divino por tr√°s dele.\n" + \
                "    *   **Reflex√£o/Pergunta Intercalada (Opcional):** \"[Fa√ßa uma pergunta direta ao espectador relacionada ao ponto rec√©m-explicado para estimular reflex√£o interna. Ex: 'Voc√™ j√° vivenciou [situa√ß√£o do ponto]? Como isso impactou sua f√©?']\"\n\n" + \
                ""3.  **\"Gatilho de Curiosidade\" Estrat√©gico:**\n" + \
                "    *   Se o roteiro for dividido em m√∫ltiplos pontos, mencione que um dos pontos vindouros (ex: \"o pen√∫ltimo\", \"o terceiro\") cont√©m uma revela√ß√£o/chave particularmente importante ou transformadora. \"[Entregue essa promessa com impacto, talvez com um tom ligeiramente diferente ou maior profundidade.]\"\n\n" + \
                ""4.  **Linguagem Emocional e Encorajadora:**\n" + \
                "    *   Use palavras que toquem o cora√ß√£o e transmitam esperan√ßa, consolo, e a natureza amorosa e s√°bia de Deus, mesmo ao abordar temas dif√≠ceis.\n\n" + \
                ""5.  **Notas de Produ√ß√£o (Impl√≠citas no Estilo):**\n" + \
                "    *   \"[O texto deve naturalmente sugerir pausas, mudan√ßas de inflex√£o e momentos de maior intensidade. Pense em como seria a narra√ß√£o ideal ao escrever.]\"\n" + \
                "    *   \"[Considere momentos onde um texto-chave na tela poderia refor√ßar o ponto principal sendo discutido.]\"\n\n" + \
                ""**III. CONCLUS√ÉO E CHAMADAS FINAIS (Aproximadamente 15-20% do roteiro):**\n\n" + \
                "1.  **Recapitula√ß√£o Breve (Opcional):** Reforce a mensagem central ou os principais aprendizados de forma concisa.\n\n" + \
                "2.  **Mensagem de Encorajamento e Esperan√ßa:** Conecte o [TEMA B√çBLICO ESPEC√çFICO] com a a√ß√£o de Deus na vida do espectador.\n\n" + \
                "3.  **Chamada para Compromisso/A√ß√£o Espiritual:**\n" + \
                "    *   Pe√ßa para o espectador comentar uma frase espec√≠fica que demonstre seu entendimento ou compromisso com a mensagem (ex: \"Eu escolho confiar no plano de Deus\", \"Senhor, guia meus passos\").\n" + \
                "    *   Explique o significado espiritual dessa declara√ß√£o.\n\n" + \
                "4.  **Chamada para Inscri√ß√£o e Compartilhamento (Mais Elaborada):**\n" + \
                "    *   Reforce a import√¢ncia de se inscrever para continuar recebendo conte√∫do que edifica a f√©.\n" + \
                "    *   Motive o compartilhamento, explicando como isso pode aben√ßoar outras vidas. \"[Seja espec√≠fico: 'Compartilhe este v√≠deo com [N√öMERO] pessoas que voc√™ sente que precisam desta palavra hoje.']\"\n\n" + \
                "5.  **Ora√ß√£o/Momento de Reflex√£o Final (Caracter√≠stica Forte):**\n" + \
                "    *   Sugira um momento de sil√™ncio, ora√ß√£o ou reflex√£o, acompanhado por m√∫sica (mencione o tipo de m√∫sica).\n" + \
                "    *   Encoraje o espectador a permanecer at√© o fim para absorver a mensagem e sentir a presen√ßa de Deus.\n\n" + \
                "6.  **B√™n√ß√£o Final:** Termine com uma b√™n√ß√£o ou palavras de paz.\n\n" + \
                ""**Considera√ß√µes Adicionais para o Prompt:**\n" + \
                "*   **Tom:** \"[Mantenha um tom pastoral, emp√°tico, mas tamb√©m com autoridade espiritual, baseado na Palavra.]\"\n" + \
                "*   **Linguagem:** \"[Use linguagem acess√≠vel, mas com profundidade b√≠blica. Evite jarg√µes teol√≥gicos excessivos sem explica√ß√£o  Evite abreviaturas. O texto j√° deve estar pronto para narra√ß√£o TTS. Caso queira uma pausa maior na narra√ß√£o, use '...'.]\"\n" + \
                "*   **Foco na Aplica√ß√£o Pr√°tica:** \"[Embora profundamente b√≠blico, o roteiro deve sempre buscar responder √† pergunta 'Como isso se aplica √† minha vida hoje?']\""
                roteiro = call_genai(client, model_name, prompt_script)
                st.session_state.roteiro = roteiro

    # Exibi√ß√£o sempre vis√≠vel do roteiro gerado
    roteiro = st.session_state.get("roteiro", "")
    st.subheader("Roteiro Gerado")
    st.text_area("", roteiro, height=300, key="script_box", disabled=True)
    if roteiro:
        st.download_button(
            label="Baixar Roteiro (.txt)",
            data=roteiro,
            file_name="roteiro_youtube.txt",
            mime="text/plain"
        )

    # Gera√ß√£o de descri√ß√£o, hashtags, tags e sugest√£o de thumb
    if st.button("Gerar Descri√ß√£o e Metadados", key="btn_gen_meta"):
        if not st.session_state.get("roteiro"):
            st.error("Gere primeiro o roteiro antes de criar metadados.")
        else:
            with st.spinner("Gerando descri√ß√£o, hashtags, tags e thumb..."):
                prompt_meta = (
                    f"Com base no roteiro acima, crie: 1) descri√ß√£o de v√≠deo de at√© 1000 caracteres; "
                    "2) hashtags entre v√≠rgulas; 3) tags separadas por v√≠rgulas; 4) descri√ß√£o em texto para thumbnail que gere curiosidade, benef√≠cio e urg√™ncia.\n\n"
                    + st.session_state.roteiro
                )
                meta = call_genai(client, model_name, prompt_meta)
                st.session_state.meta = meta

    # Exibi√ß√£o sempre vis√≠vel dos metadados
    meta = st.session_state.get("meta", "")
    st.subheader("Descri√ß√£o, Hashtags, Tags e Thumb")
    st.text_area("", meta, height=300, key="meta_box", disabled=True)
    if meta:
        st.download_button(
            label="Baixar Metadados (.txt)",
            data=meta,
            file_name="meta_youtube.txt",
            mime="text/plain"
        )


def call_genai(client, model: str, prompt: str) -> str:
    response = client.models.generate_content(
        model=model,
        contents=prompt,
    )
    return response.text.strip()


if __name__ == "__main__":
    main()
